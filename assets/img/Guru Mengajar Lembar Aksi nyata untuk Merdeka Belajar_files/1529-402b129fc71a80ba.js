"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1529],{71529:function(e,r,n){n.d(r,{CI:function(){return z},Zy:function(){return Z},fy:function(){return S},hi:function(){return x}});var t,o,a=n(47568),i=n(82670),u=n(26042),s=n(69396),l=n(29815),c=n(70655),h=n(88767),f=n(68430),g=n(9669),d=n.n(g),p=n(97512),w=n(84494),y=n(23475),v=n(88265),m=n(32178),k=n(13102),T=null,z=function(e,r,n){if(!(0,w.ZP)().enabled&&(null==n?void 0:n.message)==="Network Error")throw new p.F7(r,n);switch(e){case 400:case 500:throw new p.Hl(r,n);case 401:throw new p.zM(r,n);case 403:throw new p.lY(r,n);case 404:throw new p.dR(r,n);case 503:throw new p.TC(r,n);default:throw n}};function Z(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{axiosConfig:{},queryConfig:{},storageKey:m.zy,storageSerializer:void 0,serviceUnavailable:!1,tokenFromQueryParam:null},n=r.axiosConfig,t=void 0===n?{}:n,o=r.queryConfig,a=r.storageKey,i=void 0===a?m.zy:a,s=r.storageSerializer,c=r.serviceUnavailable,f=void 0!==c&&c,g=r.tokenFromQueryParam,d=r.errorHandlerFn,p=void 0===d?z:d,w=[];return t.data&&w.push(t.data),t.params&&w.push(t.params),w=w.length>0?[e].concat((0,l.Z)(w)):e,(0,h.useQuery)(w,function(){return x(e,t,i,f,g,s,p)},(0,u.Z)({useErrorBoundary:!0},void 0===o?{}:o))}function S(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{axiosConfig:{},mutationConfig:{},storageKey:m.zy,storageSerializer:void 0,tokenFromQueryParam:null},n=r.axiosConfig,t=void 0===n?{}:n,o=r.mutationConfig,a=r.storageKey,i=void 0===a?m.zy:a,l=r.storageSerializer,c=r.tokenFromQueryParam,f=r.errorHandlerFn,g=void 0===f?z:f;return(0,h.useMutation)(function(r){return x("function"==typeof e?e(r):e,(0,s.Z)((0,u.Z)({},t),{data:r}),i,!1,c,l,g)},void 0===o?{}:o)}var b=function(e){return(0,f.Pz)(null!=e?e:{},{arrayFormat:"none"})},_=function(e,r,n){var t=e((0,y.Gg)(r));if(t.hasOwnProperty("guruToken")&&!t.guruToken)throw new p.zM(n,null)};function x(e){return C.apply(this,arguments)}function C(){return(C=(0,a.Z)(function(e){var r,n,t,o,a,l,h,f,g,v,Z,S,x,C,A=arguments;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(r=A.length>1&&void 0!==A[1]?A[1]:{},n=A.length>2&&void 0!==A[2]?A[2]:m.zy,t=A.length>3&&void 0!==A[3]&&A[3],o=A.length>4&&void 0!==A[4]?A[4]:void 0,a=A.length>5&&void 0!==A[5]?A[5]:function(e){return e},l=A.length>6&&void 0!==A[6]?A[6]:z,h=(0,w.ZP)(),f=function(){var t="".concat(k.F).concat(e);if(o)r.headers={Authorization:"Bearer ".concat(o)};else{var i=a((0,y.Gg)(n));r.headers={Authorization:"Bearer ".concat(i.guruToken||i.accessToken)}}return d()((0,s.Z)((0,u.Z)({},r),{paramsSerializer:b,url:t}))},t)throw new p.TC(e,null);c.label=1;case 1:if(c.trys.push([1,5,,6]),o)return[3,3];return[4,(h.enabled?F:P)(n,a)];case 2:c.sent(),_(a,n,e),c.label=3;case 3:return[4,f()];case 4:return[2,c.sent().data];case 5:if(Z=c.sent(),console.log("api-error: ".concat(e),JSON.stringify(null==Z?void 0:Z.response)),(0,i.Z)(Z,p.zM)&&!T&&(T=Z,h.enabled?h.requestLogin():(x=window.location.pathname||"/home",window.location.href="/logout?from=".concat(x,"&target=/login&error=SessionError"))),(0,i.Z)(Z,p.sH))throw Z;return l(null==Z?void 0:null===(S=Z.response)||void 0===S?void 0:S.status,e,Z,Z.response),[3,6];case 6:return[2]}})})).apply(this,arguments)}function P(e){return A.apply(this,arguments)}function A(){return(A=(0,a.Z)(function(e){var r,n,o,a,i,u,s,l,h,f,g,w,v,m,T=arguments;return(0,c.__generator)(this,function(u){switch(u.label){case 0:a=(o=!!(n=(r=T.length>1&&void 0!==T[1]?T[1]:function(e){return e})((0,y.Gg)(e))).guruToken)?n.expiredAt:n.expiryToken,s=(i=new Date(a).getTime())<new Date().getTime(),l=o?"/teachers/v1alpha2/guru-token/refresh":"/teachers/v1alpha1/profile/refresh_token",_(r,e,null),u.label=1;case 1:if(u.trys.push([1,5,,6]),!s)return[3,3];return h=k.F+l,t||(g={url:h,method:"POST",headers:{Authorization:"Bearer ".concat(n.guruToken)}},w={url:(0,y.Y9)(h,n),method:"GET"},v=o?g:w,t=d()(v)),[4,t];case 2:return f=(f=u.sent().data).data||f,window.localStorage.setItem(e,JSON.stringify(f)),t=null,[2,f];case 3:return[2,n];case 4:return[3,6];case 5:throw m=u.sent(),t=null,new p.zM(l,m);case 6:return[2]}})})).apply(this,arguments)}function F(e){return D.apply(this,arguments)}function D(){return(D=(0,a.Z)(function(e){var r,n,t=arguments;return(0,c.__generator)(this,function(n){return r=t.length>1&&void 0!==t[1]?t[1]:function(e){return e},[2,(0,w.ZP)().guruTokenEnabled?function(e){return E.apply(this,arguments)}(e,r):function(e){return N.apply(this,arguments)}(e,r)]})})).apply(this,arguments)}function E(){return(E=(0,a.Z)(function(e){var r,n,t,a,i,u,s,l,h,f=arguments;return(0,c.__generator)(this,function(r){switch(r.label){case 0:n=(f.length>1&&void 0!==f[1]?f[1]:function(e){return e})((0,y.Gg)(e)),i=(t=new Date(n.expiredAt).getTime())<new Date().getTime(),r.label=1;case 1:if(r.trys.push([1,5,,6]),!i)return[3,3];return u=(0,w.ZP)(),o||(o=u.getAuthData(!0)),[4,o];case 2:return l={accessToken:"",tokenType:"Bearer",expiryToken:(s=r.sent()).expiredAt,refreshToken:"",email:s.user.email,expiredAt:s.expiredAt,guruToken:s.guruToken,user:s.user},window.localStorage.setItem(m.zy,JSON.stringify(l)),[2,l];case 3:return[2,n];case 4:return[3,6];case 5:throw h=r.sent(),o=null,new p.zM("app-refresh-session-error",h);case 6:return[2]}})})).apply(this,arguments)}function N(){return(N=(0,a.Z)(function(e){var r,n,t,o,a,i,u,s,l,h,f=arguments;return(0,c.__generator)(this,function(r){switch(r.label){case 0:if(n=(f.length>1&&void 0!==f[1]?f[1]:function(e){return e})((0,y.Gg)(e)),!((t=new Date(n.expiryToken).getTime())<new Date().getTime()))return[3,2];return(i=(0,w.ZP)()).refreshToken(),[4,(0,v.V)(1e3)];case 1:return r.sent(),u=i.requestAccessToken(),s=new Date(new Date().getTime()+36e5).toISOString(),l=JSON.parse(i.getUser()),h={accessToken:u,tokenType:"Bearer",expiryToken:s,refreshToken:"dummy-refresh-token",email:i.getEmail(),expiredAt:s,guruToken:"",user:{id:l.id,name:l.name,email:l.email,picture:l.photoUrl,groups:l.groups}},window.localStorage.setItem(m.zy,JSON.stringify(h)),[2,h];case 2:return[2,n]}})})).apply(this,arguments)}}}]);
//# sourceMappingURL=1529-402b129fc71a80ba.js.map